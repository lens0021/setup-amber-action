---
name: Test
on:
  - push
permissions:
  contents: read
jobs:
  test-default:
    name: Test with default settings
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest]
    steps:
      - uses: actions/checkout@v6
        with:
          persist-credentials: false

      - name: Setup Amber
        uses: ./
        with:
          amber-version: 0.4.0-alpha

      - name: Verify installation
        run: |
          which amber
          amber --version
          echo 'echo "Hello from Amber!"' > test.ab
          amber build test.ab
          bash test.sh

  test-custom-version:
    name: Test with custom version
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
        with:
          persist-credentials: false

      - uses: ./
        with:
          amber-version: 0.5.0-alpha

      - run: amber --version

  test-cache-disabled:
    name: Test with cache disabled
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
        with:
          persist-credentials: false

      - uses: ./
        with:
          amber-version: 0.4.0-alpha
          enable-cache: false

      - run: amber --version

  test-custom-cache-path:
    name: Test with custom cache path
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
        with:
          persist-credentials: false

      - uses: ./
        with:
          amber-version: 0.4.0-alpha
          cache-path: /tmp/amber-test-cache

      - run: amber --version

  test-custom-bin-path:
    name: Test with custom cache path
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
        with:
          persist-credentials: false

      - uses: ./
        with:
          amber-version: 0.4.0-alpha
          bin-path: ./

      - run: ./amber --version
